# Notification System Specification

## Overview

"ì—°ì •" ì„œë¹„ìŠ¤ì˜ ì•Œë¦¼ ì‹œìŠ¤í…œ ìŠ¤í™ì…ë‹ˆë‹¤.
ì¹´ì¹´ì˜¤ ì•Œë¦¼í†¡, ì´ë©”ì¼, ì¸ì•± ì•Œë¦¼ì„ í†µí•´ ì‚¬ìš©ìì—ê²Œ ì •ë³´ë¥¼ ì „ë‹¬í•©ë‹ˆë‹¤.

---

## 1. Notification Channels

### 1.1. ì±„ë„ êµ¬ì„±

| Channel | ìš©ë„ | Provider |
|---------|------|----------|
| **ì¹´ì¹´ì˜¤ ì•Œë¦¼í†¡** | ì£¼ìš” ì•Œë¦¼ (ì¿ í°, RSVP ë“±) | ì•Œë¦¬ê³  / ë¹„ì¦ˆë¿Œë¦¬ì˜¤ |
| **ì´ë©”ì¼** | ìƒì„¸ ì •ë³´, ë¦¬í¬íŠ¸ | Resend / SendGrid |
| **ì¸ì•± ì•Œë¦¼** | ì‹¤ì‹œê°„ ì•Œë¦¼ | ìì²´ êµ¬í˜„ |

### 1.2. ì±„ë„ ì„ íƒ ì›ì¹™

| ì•Œë¦¼ ìœ í˜• | ì•Œë¦¼í†¡ | ì´ë©”ì¼ | ì¸ì•± |
|----------|--------|-------|------|
| ì¿ í° ë°œê¸‰ | âœ“ í•„ìˆ˜ | | |
| ì²­ì²©ì¥ ë°œí–‰ ì™„ë£Œ | âœ“ | âœ“ | âœ“ |
| ìƒˆ RSVP ì‘ë‹µ | | | âœ“ |
| RSVP ì¼ì¼ ìš”ì•½ | | âœ“ | |
| ìƒˆ ë°©ëª…ë¡ | | | âœ“ |
| ì¿ í° ë§Œë£Œ ì„ë°• | âœ“ | âœ“ | |
| ì²­ì²©ì¥ ë§Œë£Œ ì„ë°• | âœ“ | âœ“ | âœ“ |
| ë§ˆì¼€íŒ… | | âœ“ (ë™ì˜ ì‹œ) | |

---

## 2. ì¹´ì¹´ì˜¤ ì•Œë¦¼í†¡

### 2.1. ì„¤ì •

```typescript
// lib/alimtalk.ts
import axios from 'axios';

interface AlimtalkConfig {
  apiKey: string;
  userId: string;
  senderKey: string;
}

export class AlimtalkClient {
  private config: AlimtalkConfig;
  
  constructor(config: AlimtalkConfig) {
    this.config = config;
  }
  
  async send(params: {
    templateCode: string;
    recipientNo: string;
    variables: Record<string, string>;
  }): Promise<void> {
    const response = await axios.post(
      'https://kakaoapi.aligo.in/akv10/alimtalk/send/',
      {
        apikey: this.config.apiKey,
        userid: this.config.userId,
        senderkey: this.config.senderKey,
        tpl_code: params.templateCode,
        receiver_1: params.recipientNo,
        ...this.flattenVariables(params.variables),
      }
    );
    
    if (response.data.code !== 0) {
      throw new Error(`Alimtalk failed: ${response.data.message}`);
    }
  }
}
```

### 2.2. í…œí”Œë¦¿ ëª©ë¡

| í…œí”Œë¦¿ ì½”ë“œ | ìš©ë„ | ë³€ìˆ˜ |
|-------------|------|------|
| `COUPON_ISSUED` | ì¿ í° ë°œê¸‰ | ê³ ê°ëª…, ì¿ í°ì½”ë“œ, ë§Œë£Œì¼ |
| `COUPON_EXPIRY_7D` | ì¿ í° 7ì¼ ì „ ë§Œë£Œ | ê³ ê°ëª…, ì¿ í°ì½”ë“œ, ë§Œë£Œì¼ |
| `INVITATION_PUBLISHED` | ì²­ì²©ì¥ ë°œí–‰ ì™„ë£Œ | ì‹ ë‘ëª…, ì‹ ë¶€ëª…, URL |
| `INVITATION_EXPIRY_30D` | ì²­ì²©ì¥ 30ì¼ ì „ ë§Œë£Œ | ì‹ ë‘ëª…, ì‹ ë¶€ëª…, ë§Œë£Œì¼ |

### 2.3. í…œí”Œë¦¿ ìƒì„¸

#### COUPON_ISSUED (ì¿ í° ë°œê¸‰)

```
[ì—°ì •] ì²­ì²©ì¥ ì¿ í°ì´ ë„ì°©í–ˆì–´ìš” ğŸ’Œ

ì•ˆë…•í•˜ì„¸ìš”, #{ê³ ê°ëª…}ë‹˜!

í”„ë¦¬ë¯¸ì—„ ì²­ì²©ì¥ ì¿ í°ì´ ë°œê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ« ì¿ í° ì½”ë“œ: #{ì¿ í°ì½”ë“œ}
ğŸ“… ìœ íš¨ê¸°ê°„: #{ë§Œë£Œì¼}ê¹Œì§€
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ì§€ê¸ˆ ë°”ë¡œ ì²­ì²©ì¥ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”!

â–¶ ì²­ì²©ì¥ ë§Œë“¤ê¸°
https://yeonjeong.kr/start

â€» ì¿ í° ì½”ë“œë¥¼ ë¶„ì‹¤í•˜ì§€ ì•Šë„ë¡ 
  ìŠ¤í¬ë¦°ìƒ·ìœ¼ë¡œ ì €ì¥í•´ì£¼ì„¸ìš”.
```

#### COUPON_EXPIRY_7D (ì¿ í° ë§Œë£Œ ì„ë°•)

```
[ì—°ì •] ì¿ í° ë§Œë£Œ ì•ˆë‚´ â°

#{ê³ ê°ëª…}ë‹˜,
ë³´ìœ í•˜ì‹  ì¿ í°ì´ 7ì¼ í›„ ë§Œë£Œë©ë‹ˆë‹¤.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ« ì¿ í°: #{ì¿ í°ì½”ë“œ}
ğŸ“… ë§Œë£Œ: #{ë§Œë£Œì¼}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ì²­ì²©ì¥ì„ ì•„ì§ ë§Œë“¤ì§€ ì•Šìœ¼ì…¨ë‹¤ë©´
ë§Œë£Œ ì „ì— ì‚¬ìš©í•´ì£¼ì„¸ìš”!

â–¶ ì²­ì²©ì¥ ë§Œë“¤ê¸°
https://yeonjeong.kr/start
```

#### INVITATION_PUBLISHED (ì²­ì²©ì¥ ë°œí–‰)

```
[ì—°ì •] ì²­ì²©ì¥ì´ ë°œí–‰ë˜ì—ˆì–´ìš” ğŸ‰

#{ì‹ ë‘ëª…} â™¥ #{ì‹ ë¶€ëª…}ë‹˜,
ì²­ì²©ì¥ì´ ë°œí–‰ë˜ì—ˆìŠµë‹ˆë‹¤!

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”— ì²­ì²©ì¥ ì£¼ì†Œ
#{ì²­ì²©ì¥URL}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ì´ì œ ì†Œì¤‘í•œ ë¶„ë“¤ì—ê²Œ ê³µìœ í•´ë³´ì„¸ìš”.

â–¶ ê³µìœ  & ê´€ë¦¬í•˜ê¸°
https://yeonjeong.kr/dashboard

í–‰ë³µí•œ ê²°í˜¼ ì¤€ë¹„ ë˜ì„¸ìš”! ğŸ’•
```

#### INVITATION_EXPIRY_30D (ì²­ì²©ì¥ ë§Œë£Œ ì„ë°•)

```
[ì—°ì •] ì²­ì²©ì¥ ë§Œë£Œ ì•ˆë‚´

#{ì‹ ë‘ëª…} â™¥ #{ì‹ ë¶€ëª…}ë‹˜,

ì²­ì²©ì¥ì´ 30ì¼ í›„ ë§Œë£Œë©ë‹ˆë‹¤.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“… ë§Œë£Œì¼: #{ë§Œë£Œì¼}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ë§Œë£Œ ì „ì— ë°©ëª…ë¡, RSVP ë°ì´í„°ë¥¼
ë°±ì—…í•´ë‘ì„¸ìš”.

â–¶ ë°ì´í„° ë°±ì—…í•˜ê¸°
https://yeonjeong.kr/dashboard

â€» ë§Œë£Œ í›„ì—ëŠ” ì²­ì²©ì¥ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
```

### 2.4. ì „ì†¡ ì œí•œ

| ì œí•œ | ê°’ |
|------|-----|
| ì¼ì¼ ë°œì†¡ í•œë„ | 1,000ê±´ (ê¸°ë³¸) |
| ë™ì¼ ë²ˆí˜¸ ì¼ì¼ í•œë„ | 10ê±´ |
| ì•¼ê°„ ë°œì†¡ ì œí•œ | 21:00 ~ 08:00 (ê´‘ê³ ì„±ë§Œ) |

---

## 3. ì´ë©”ì¼

### 3.1. ì„¤ì • (Resend)

```typescript
// lib/email.ts
import { Resend } from 'resend';

const resend = new Resend(process.env.RESEND_API_KEY);

export async function sendEmail(params: {
  to: string;
  subject: string;
  template: string;
  variables: Record<string, unknown>;
}) {
  const html = await renderTemplate(params.template, params.variables);
  
  await resend.emails.send({
    from: 'ì—°ì • <hello@yeonjeong.kr>',
    to: params.to,
    subject: params.subject,
    html,
  });
}
```

### 3.2. ì´ë©”ì¼ í…œí”Œë¦¿

| í…œí”Œë¦¿ | ìš©ë„ | íŠ¸ë¦¬ê±° |
|--------|------|--------|
| `welcome` | ê°€ì… í™˜ì˜ | íšŒì›ê°€ì… |
| `invitation-published` | ë°œí–‰ ì™„ë£Œ | ì²­ì²©ì¥ ë°œí–‰ |
| `rsvp-daily-summary` | RSVP ì¼ì¼ ìš”ì•½ | ë§¤ì¼ ì˜¤ì „ 9ì‹œ |
| `coupon-expiry` | ì¿ í° ë§Œë£Œ ì•Œë¦¼ | 7ì¼ ì „ |
| `invitation-expiry` | ì²­ì²©ì¥ ë§Œë£Œ ì•Œë¦¼ | 30ì¼, 7ì¼ ì „ |
| `account-deletion` | íƒˆí‡´ ì™„ë£Œ | íšŒì› íƒˆí‡´ |

### 3.3. ì´ë©”ì¼ ë””ìì¸ ê°€ì´ë“œ

```html
<!-- ê¸°ë³¸ ë ˆì´ì•„ì›ƒ -->
<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      font-family: 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif;
      background-color: #FDF8F3;
      padding: 40px 20px;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      padding: 40px;
    }
    .header {
      text-align: center;
      margin-bottom: 32px;
    }
    .logo {
      font-family: 'Nanum Myeongjo', serif;
      font-size: 24px;
      color: #FF7A5C;
    }
    .content {
      color: #5D4E4E;
      line-height: 1.6;
    }
    .button {
      display: inline-block;
      background: linear-gradient(135deg, #FF8E76, #FF7A5C);
      color: white;
      padding: 14px 32px;
      border-radius: 8px;
      text-decoration: none;
      margin: 24px 0;
    }
    .footer {
      text-align: center;
      color: #8B7E7E;
      font-size: 12px;
      margin-top: 32px;
      padding-top: 24px;
      border-top: 1px solid #F0E8E4;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo">ì—°ì •.</div>
    </div>
    <div class="content">
      {{content}}
    </div>
    <div class="footer">
      Â© 2025 ì—°ì •. All rights reserved.<br>
      ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123<br>
      <a href="{{unsubscribe_url}}">ìˆ˜ì‹ ê±°ë¶€</a>
    </div>
  </div>
</body>
</html>
```

### 3.4. RSVP ì¼ì¼ ìš”ì•½ ì´ë©”ì¼

```
ì œëª©: [ì—°ì •] ì˜¤ëŠ˜ì˜ RSVP í˜„í™© - ë¯¼ì˜ â™¥ ì§€í›ˆ

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ“Š ì˜¤ëŠ˜ì˜ RSVP í˜„í™©
2025ë…„ 1ì›” 7ì¼

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âœ… ìƒˆë¡œìš´ ì‘ë‹µ: 5ê±´

â€¢ ê¹€ì² ìˆ˜ - ì°¸ì„ (2ëª…, ì‹ì‚¬ ì˜ˆì •)
â€¢ ì´ì˜í¬ - ì°¸ì„ (1ëª…, ì‹ì‚¬ ì˜ˆì •)
â€¢ ë°•ì§€ë¯¼ - ë§ˆìŒë§Œ ì „í•¨
â€¢ ìµœìˆ˜ì§„ - ì°¸ì„ (3ëª…, ì‹ì‚¬ ì˜ˆì •)
â€¢ ì •ë¯¼í˜¸ - ì°¸ì„ (2ëª…, ì‹ì‚¬ ì˜ˆì •)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ“ˆ ì „ì²´ í˜„í™©

ì´ ì‘ë‹µ: 52ëª…
â”œ ì°¸ì„: 45ëª… (86.5%)
â”” ë§ˆìŒë§Œ: 7ëª… (13.5%)

ì‹ì‚¬ ì¸ì›: 42ëª…
â”œ ì‹ ë‘ì¸¡: 22ëª…
â”” ì‹ ë¶€ì¸¡: 20ëª…

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â–¶ ìƒì„¸ í˜„í™© ë³´ê¸°
https://yeonjeong.kr/dashboard/rsvp

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

---

## 4. ì¸ì•± ì•Œë¦¼

### 4.1. ì•Œë¦¼ ìœ í˜•

| Type | Description | Icon |
|------|-------------|------|
| `rsvp` | ìƒˆ RSVP ì‘ë‹µ | âœ… |
| `guestbook` | ìƒˆ ë°©ëª…ë¡ | ğŸ’¬ |
| `system` | ì‹œìŠ¤í…œ ì•Œë¦¼ | â„¹ï¸ |
| `expiry` | ë§Œë£Œ ì•Œë¦¼ | âš ï¸ |

### 4.2. ì•Œë¦¼ ë°ì´í„° êµ¬ì¡°

```typescript
interface Notification {
  id: string;
  userId: string;
  type: 'rsvp' | 'guestbook' | 'system' | 'expiry';
  title: string;
  message: string;
  data?: {
    invitationId?: string;
    rsvpId?: string;
    guestbookId?: string;
  };
  read: boolean;
  createdAt: Date;
}
```

### 4.3. UI ì»´í¬ë„ŒíŠ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì•Œë¦¼                                   ëª¨ë‘ ì½ìŒ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ âœ… ìƒˆ RSVP ì‘ë‹µ                    ë°©ê¸ˆ ì „â”‚ â”‚
â”‚ â”‚    ê¹€ì² ìˆ˜ë‹˜ì´ ì°¸ì„ ì˜ì‚¬ë¥¼ ë°í˜”ì–´ìš” (2ëª…) â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ’¬ ìƒˆ ë°©ëª…ë¡                      10ë¶„ ì „â”‚ â”‚
â”‚ â”‚    ì´ì˜í¬ë‹˜ì´ ì¶•í•˜ ë©”ì‹œì§€ë¥¼ ë‚¨ê²¼ì–´ìš”    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ âš ï¸ ì¿ í° ë§Œë£Œ ì„ë°•                 1ì¼ ì „â”‚ â”‚
â”‚ â”‚    ë³´ìœ í•œ ì¿ í°ì´ 7ì¼ í›„ ë§Œë£Œë©ë‹ˆë‹¤      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.4. ì‹¤ì‹œê°„ ì•Œë¦¼ (ì„ íƒì‚¬í•­)

```typescript
// SSE (Server-Sent Events) ë˜ëŠ” Polling
// MVPì—ì„œëŠ” Polling ê¶Œì¥

// í´ë¼ì´ì–¸íŠ¸
function useNotifications() {
  const [notifications, setNotifications] = useState([]);
  
  useEffect(() => {
    const interval = setInterval(async () => {
      const newNotifs = await fetchNotifications();
      setNotifications(newNotifs);
    }, 30000); // 30ì´ˆë§ˆë‹¤
    
    return () => clearInterval(interval);
  }, []);
  
  return notifications;
}
```

---

## 5. ì•Œë¦¼ íŠ¸ë¦¬ê±° (ìë™ ë°œì†¡)

### 5.1. ì´ë²¤íŠ¸ ê¸°ë°˜ ì•Œë¦¼

| ì´ë²¤íŠ¸ | ì•Œë¦¼í†¡ | ì´ë©”ì¼ | ì¸ì•± |
|--------|--------|-------|------|
| ì¿ í° ë°œê¸‰ | âœ“ ì¦‰ì‹œ | | |
| ì²­ì²©ì¥ ë°œí–‰ | âœ“ ì¦‰ì‹œ | âœ“ ì¦‰ì‹œ | âœ“ ì¦‰ì‹œ |
| ìƒˆ RSVP | | | âœ“ ì¦‰ì‹œ |
| ìƒˆ ë°©ëª…ë¡ | | | âœ“ ì¦‰ì‹œ |

### 5.2. ìŠ¤ì¼€ì¤„ ì•Œë¦¼ (Cron Job)

| ìŠ¤ì¼€ì¤„ | ì•Œë¦¼ | ëŒ€ìƒ |
|--------|------|------|
| ë§¤ì¼ 09:00 | RSVP ì¼ì¼ ìš”ì•½ | ë°œí–‰ëœ ì²­ì²©ì¥ (ì‘ë‹µ ìˆëŠ” ê²½ìš°) |
| ë§¤ì¼ 10:00 | ì¿ í° 7ì¼ ì „ ë§Œë£Œ | ë¯¸ì‚¬ìš© ì¿ í° ë³´ìœ ì |
| ë§¤ì¼ 10:00 | ì²­ì²©ì¥ 30ì¼ ì „ ë§Œë£Œ | í•´ë‹¹ ì²­ì²©ì¥ |
| ë§¤ì¼ 10:00 | ì²­ì²©ì¥ 7ì¼ ì „ ë§Œë£Œ | í•´ë‹¹ ì²­ì²©ì¥ |

### 5.3. Cron Job êµ¬í˜„

```typescript
// app/api/cron/notifications/route.ts
import { NextRequest } from 'next/server';

export async function GET(request: NextRequest) {
  // Vercel Cron ì¸ì¦
  const authHeader = request.headers.get('authorization');
  if (authHeader !== `Bearer ${process.env.CRON_SECRET}`) {
    return new Response('Unauthorized', { status: 401 });
  }
  
  // ì¿ í° ë§Œë£Œ ì•Œë¦¼
  await sendCouponExpiryNotifications();
  
  // ì²­ì²©ì¥ ë§Œë£Œ ì•Œë¦¼
  await sendInvitationExpiryNotifications();
  
  // RSVP ìš”ì•½ ë°œì†¡
  await sendRsvpDailySummaries();
  
  return Response.json({ success: true });
}

// vercel.json
{
  "crons": [
    {
      "path": "/api/cron/notifications",
      "schedule": "0 0 * * *"  // ë§¤ì¼ 00:00 UTC (09:00 KST)
    }
  ]
}
```

---

## 6. ì•Œë¦¼ ì„¤ì • (ì‚¬ìš©ì)

### 6.1. ì„¤ì • UI

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì•Œë¦¼ ì„¤ì •                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ğŸ“± ì¹´ì¹´ì˜¤ ì•Œë¦¼í†¡                                            â”‚
â”‚  â”œâ”€ ì¿ í° ë°œê¸‰/ë§Œë£Œ ì•Œë¦¼          [ON]                        â”‚
â”‚  â””â”€ ì²­ì²©ì¥ ë§Œë£Œ ì•Œë¦¼             [ON]                        â”‚
â”‚                                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                             â”‚
â”‚  ğŸ“§ ì´ë©”ì¼                                                   â”‚
â”‚  â”œâ”€ ì²­ì²©ì¥ ë°œí–‰ ì™„ë£Œ             [ON]                        â”‚
â”‚  â”œâ”€ RSVP ì¼ì¼ ìš”ì•½               [ON]                        â”‚
â”‚  â”œâ”€ ì¿ í°/ì²­ì²©ì¥ ë§Œë£Œ ì•Œë¦¼        [ON]                        â”‚
â”‚  â””â”€ ë§ˆì¼€íŒ… ì •ë³´ ìˆ˜ì‹              [OFF]                       â”‚
â”‚                                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                             â”‚
â”‚  ğŸ”” ì¸ì•± ì•Œë¦¼                                                â”‚
â”‚  â”œâ”€ ìƒˆ RSVP ì‘ë‹µ                 [ON]                        â”‚
â”‚  â””â”€ ìƒˆ ë°©ëª…ë¡                    [ON]                        â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2. ì„¤ì • ë°ì´í„°

```typescript
interface NotificationSettings {
  userId: string;
  
  // ì¹´ì¹´ì˜¤ ì•Œë¦¼í†¡
  kakao: {
    coupon: boolean;
    invitationExpiry: boolean;
  };
  
  // ì´ë©”ì¼
  email: {
    invitationPublished: boolean;
    rsvpDailySummary: boolean;
    expiryAlerts: boolean;
    marketing: boolean;
  };
  
  // ì¸ì•±
  inApp: {
    newRsvp: boolean;
    newGuestbook: boolean;
  };
}
```

---

## 7. ë§ˆì¼€íŒ… ì•Œë¦¼

### 7.1. ë°œì†¡ ê·œì¹™

| ê·œì¹™ | ìš”êµ¬ì‚¬í•­ |
|------|----------|
| ìˆ˜ì‹  ë™ì˜ | ëª…ì‹œì  opt-in í•„ìˆ˜ |
| ë°œì†¡ ì‹œê°„ | 08:00 ~ 21:00 |
| ìˆ˜ì‹  ê±°ë¶€ | ëª¨ë“  ë©”ì‹œì§€ì— ê±°ë¶€ ë§í¬ |
| ë¹ˆë„ | ì£¼ 1íšŒ ì´í•˜ |

### 7.2. ë§ˆì¼€íŒ… ì´ë©”ì¼ ìœ í˜•

| ìœ í˜• | ëŒ€ìƒ | ë‚´ìš© |
|------|------|------|
| ì‹ ê·œ í…Œë§ˆ | ê°€ì…ì ì „ì²´ | ìƒˆ í…Œë§ˆ ì¶œì‹œ ì•ˆë‚´ |
| ì‹œì¦Œ í”„ë¡œëª¨ì…˜ | ë¯¸ë°œí–‰ ì‚¬ìš©ì | í• ì¸ ì¿ í° |
| ì„œë¹„ìŠ¤ ì—…ë°ì´íŠ¸ | ê°€ì…ì ì „ì²´ | ìƒˆ ê¸°ëŠ¥ ì•ˆë‚´ |

### 7.3. ë§ˆì¼€íŒ… ë°œì†¡ Flow

```
1. ë§ˆì¼€íŒ… ë™ì˜ ì‚¬ìš©ì ì¡°íšŒ
      â†“
2. ì„¸ê·¸ë¨¼íŠ¸ í•„í„°ë§ (ëŒ€ìƒ ì¡°ê±´)
      â†“
3. ì´ë©”ì¼ ìƒì„± (í…œí”Œë¦¿ + ë°ì´í„°)
      â†“
4. ë°œì†¡ (Rate limiting ì ìš©)
      â†“
5. ê²°ê³¼ ë¡œê¹… (ì˜¤í”ˆìœ¨, í´ë¦­ë¥ )
```

---

## 8. ì—ëŸ¬ ì²˜ë¦¬ & ì¬ì‹œë„

### 8.1. ì•Œë¦¼í†¡ ì‹¤íŒ¨ ì²˜ë¦¬

```typescript
async function sendAlimtalkWithRetry(params: AlimtalkParams) {
  const maxRetries = 3;
  let lastError: Error;
  
  for (let i = 0; i < maxRetries; i++) {
    try {
      await alimtalk.send(params);
      return; // ì„±ê³µ
    } catch (error) {
      lastError = error;
      
      // ì¬ì‹œë„ ê°€ëŠ¥í•œ ì—ëŸ¬ì¸ì§€ í™•ì¸
      if (!isRetryableError(error)) {
        throw error;
      }
      
      // ì§€ìˆ˜ ë°±ì˜¤í”„
      await sleep(Math.pow(2, i) * 1000);
    }
  }
  
  // ìµœì¢… ì‹¤íŒ¨ â†’ ë¡œê¹… + ì´ë©”ì¼ ëŒ€ì²´ ë°œì†¡
  logger.error('Alimtalk failed after retries', { params, error: lastError });
  await sendFallbackEmail(params);
}
```

### 8.2. ì‹¤íŒ¨ ì•Œë¦¼ ëŒ€ì‹œë³´ë“œ (Admin)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì•Œë¦¼ ë°œì†¡ í˜„í™©                               ì˜¤ëŠ˜           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  ë°œì†¡ ì„±ê³µ  â”‚ â”‚  ë°œì†¡ ì‹¤íŒ¨  â”‚ â”‚  ì„±ê³µë¥     â”‚              â”‚
â”‚  â”‚    245     â”‚ â”‚     3      â”‚ â”‚   98.8%   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                             â”‚
â”‚  âš ï¸ ìµœê·¼ ì‹¤íŒ¨                                               â”‚
â”‚  â€¢ 10:30 COUPON_ISSUED â†’ 010-1234-**** - ë²ˆí˜¸ ì˜¤ë¥˜          â”‚
â”‚  â€¢ 09:15 RSVP_SUMMARY â†’ user@*** - ë©”ì¼ ë°˜ì†¡                â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. ë¹„ìš©

### 9.1. ì•Œë¦¼í†¡ ë¹„ìš© (ì•Œë¦¬ê³  ê¸°ì¤€)

| í•­ëª© | ë‹¨ê°€ |
|------|------|
| ì•Œë¦¼í†¡ | 8ì›/ê±´ |
| ì¹œêµ¬í†¡ | 15ì›/ê±´ |
| ëŒ€ëŸ‰ ë°œì†¡ í• ì¸ | ì›” 10,000ê±´ ì´ìƒ ì‹œ í˜‘ì˜ |

### 9.2. ì´ë©”ì¼ ë¹„ìš© (Resend ê¸°ì¤€)

| Plan | ê°€ê²© | ë°œì†¡ëŸ‰ |
|------|------|--------|
| Free | $0 | 3,000/ì›” |
| Pro | $20/ì›” | 50,000/ì›” |

### 9.3. ì›”ê°„ ì˜ˆìƒ ë¹„ìš© (1,000 ì‚¬ìš©ì ê¸°ì¤€)

```
ì•Œë¦¼í†¡:
â€¢ ì¿ í° ë°œê¸‰: 1,000ê±´ Ã— 8ì› = 8,000ì›
â€¢ ë§Œë£Œ ì•Œë¦¼: 500ê±´ Ã— 8ì› = 4,000ì›
â€¢ ì†Œê³„: 12,000ì›

ì´ë©”ì¼:
â€¢ Free tier ë‚´ (3,000ê±´)

ì´ ì˜ˆìƒ: ì•½ 15,000ì›/ì›”
```

---

## 10. í™˜ê²½ ë³€ìˆ˜

```bash
# ì¹´ì¹´ì˜¤ ì•Œë¦¼í†¡ (ì•Œë¦¬ê³ )
ALIMTALK_API_KEY=
ALIMTALK_USER_ID=
ALIMTALK_SENDER_KEY=

# ì´ë©”ì¼ (Resend)
RESEND_API_KEY=
EMAIL_FROM=hello@yeonjeong.kr

# Cron
CRON_SECRET=

# ì•Œë¦¼ ì„¤ì •
NOTIFICATION_ENABLED=true
MARKETING_ENABLED=true
```

---

## 11. ëª¨ë‹ˆí„°ë§

### 11.1. ì¶”ì  ë©”íŠ¸ë¦­

| Metric | Description |
|--------|-------------|
| `notification.sent` | ë°œì†¡ ìˆ˜ |
| `notification.failed` | ì‹¤íŒ¨ ìˆ˜ |
| `notification.latency` | ë°œì†¡ ì§€ì—° ì‹œê°„ |
| `email.open_rate` | ì´ë©”ì¼ ì˜¤í”ˆìœ¨ |
| `email.click_rate` | ì´ë©”ì¼ í´ë¦­ë¥  |

### 11.2. ì•Œë¦¼ ë¡œê·¸

```typescript
interface NotificationLog {
  id: string;
  type: 'alimtalk' | 'email' | 'inapp';
  templateCode: string;
  recipient: string;  // ë§ˆìŠ¤í‚¹
  status: 'sent' | 'failed' | 'pending';
  errorMessage?: string;
  sentAt: Date;
  metadata?: Record<string, unknown>;
}
```
