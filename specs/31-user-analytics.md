# User Analytics Dashboard Specification

## Overview

청첩장 제작자(Host)를 위한 분석/통계 대시보드 스펙입니다.
청첩장 성과를 확인하고 하객 반응을 파악할 수 있습니다.

---

## 주요 지표 (KPIs)

| 지표 | 설명 | 계산 방식 |
|------|------|----------|
| **총 방문자 수** | 청첩장을 열어본 사람 수 | Unique visitors |
| **RSVP 응답률** | 참석 여부를 제출한 비율 | RSVP 제출 / 총 방문자 |
| **예상 참석 인원** | 참석 응답한 총 인원 | SUM(참석 인원) |
| **방명록 작성 수** | 축하 메시지 수 | Guestbook entries |
| **공유 횟수** | 카카오톡/링크 공유 횟수 | Share events |
| **평균 체류 시간** | 청첩장 평균 열람 시간 | Avg. session duration |

---

## 1. 대시보드 레이아웃

### 1.1. 모바일 뷰

```
┌─────────────────────────────┐
│ ← 내 청첩장      [공유] [편집] │
├─────────────────────────────┤
│                             │
│  민영 ♥ 지훈                 │
│  D-45                       │
│                             │
├─────────────────────────────┤
│                             │
│  📊 한눈에 보기              │
│                             │
│  ┌─────────┐ ┌─────────┐   │
│  │   247   │ │   68%   │   │
│  │  방문자  │ │ RSVP율  │   │
│  └─────────┘ └─────────┘   │
│                             │
│  ┌─────────┐ ┌─────────┐   │
│  │   156   │ │   32    │   │
│  │ 예상참석 │ │  방명록  │   │
│  └─────────┘ └─────────┘   │
│                             │
├─────────────────────────────┤
│                             │
│  📈 일별 방문자              │
│  ┌─────────────────────┐   │
│  │    📊 차트           │   │
│  └─────────────────────┘   │
│                             │
├─────────────────────────────┤
│                             │
│  ✅ RSVP 현황               │
│  ┌─────────────────────┐   │
│  │ 참석 142 (91%)       │   │
│  │ ████████████░░      │   │
│  │ 불참 14 (9%)         │   │
│  └─────────────────────┘   │
│                             │
│  신랑측 78명 / 신부측 78명   │
│                             │
│  [RSVP 명단 보기]           │
│                             │
├─────────────────────────────┤
│                             │
│  💬 최근 방명록              │
│  ┌─────────────────────┐   │
│  │ "축하해! 행복하게..."  │   │
│  │ 김철수 • 방금 전      │   │
│  ├─────────────────────┤   │
│  │ "결혼 축하해요~"      │   │
│  │ 이영희 • 1시간 전     │   │
│  └─────────────────────┘   │
│                             │
│  [전체 보기]                │
│                             │
└─────────────────────────────┘
```

### 1.2. 데스크탑 뷰

```
┌─────────────────────────────────────────────────────────────────────────┐
│  연정.                                민영 ♥ 지훈    [공유] [편집] [미리보기] │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │                                                                  │  │
│  │   📊 한눈에 보기                              기간: [최근 30일 ▼]   │  │
│  │                                                                  │  │
│  │   ┌────────┐  ┌────────┐  ┌────────┐  ┌────────┐  ┌────────┐   │  │
│  │   │  247   │  │  68%   │  │  156   │  │   32   │  │  89    │   │  │
│  │   │ 방문자  │  │ RSVP율 │  │ 예상참석│  │ 방명록  │  │ 공유    │   │  │
│  │   │ +12 ↑  │  │ +5% ↑  │  │ +8 ↑   │  │ +3 ↑   │  │ +7 ↑   │   │  │
│  │   └────────┘  └────────┘  └────────┘  └────────┘  └────────┘   │  │
│  │                                                                  │  │
│  └──────────────────────────────────────────────────────────────────┘  │
│                                                                         │
│  ┌─────────────────────────────────┐  ┌─────────────────────────────┐  │
│  │                                 │  │                             │  │
│  │  📈 방문자 추이                  │  │  ✅ RSVP 현황               │  │
│  │                                 │  │                             │  │
│  │  ┌─────────────────────────┐   │  │  참석    142명 (91%)        │  │
│  │  │                         │   │  │  ████████████████░░        │  │
│  │  │    일별 방문자 차트       │   │  │                             │  │
│  │  │                         │   │  │  불참    14명 (9%)          │  │
│  │  │                         │   │  │  ███░░░░░░░░░░░░░░         │  │
│  │  └─────────────────────────┘   │  │                             │  │
│  │                                 │  │  ─────────────────────────  │  │
│  │  오늘 32명 방문                  │  │                             │  │
│  │  최고 기록: 1월 5일 (58명)       │  │  신랑측  78명 (50%)         │  │
│  │                                 │  │  신부측  78명 (50%)         │  │
│  │                                 │  │                             │  │
│  └─────────────────────────────────┘  │  [명단 다운로드] [상세 보기]  │  │
│                                       │                             │  │
│                                       └─────────────────────────────┘  │
│                                                                         │
│  ┌─────────────────────────────────┐  ┌─────────────────────────────┐  │
│  │                                 │  │                             │  │
│  │  🖼️ 인기 사진 TOP 3             │  │  💬 최근 방명록              │  │
│  │                                 │  │                             │  │
│  │  ┌─────┐ ┌─────┐ ┌─────┐      │  │  ┌─────────────────────┐   │  │
│  │  │  1  │ │  2  │ │  3  │      │  │  │ "축하해! 행복하게..." │   │  │
│  │  │ 👁️58│ │ 👁️45│ │ 👁️32│      │  │  │ 김철수 • 방금 전     │   │  │
│  │  └─────┘ └─────┘ └─────┘      │  │  ├─────────────────────┤   │  │
│  │                                 │  │  │ "결혼 축하드려요~"   │   │  │
│  │  평균 조회: 4.2장/방문자         │  │  │ 이영희 • 1시간 전    │   │  │
│  │                                 │  │  └─────────────────────┘   │  │
│  │                                 │  │                             │  │
│  └─────────────────────────────────┘  │  [전체 보기]               │  │
│                                       │                             │  │
│                                       └─────────────────────────────┘  │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 2. 핵심 지표 카드

### 2.1. 총 방문자

```tsx
interface VisitorStats {
  total: number;           // 총 방문자
  today: number;           // 오늘 방문자
  trend: number;           // 전일 대비 증감
  uniqueByDevice: {
    mobile: number;        // 모바일
    desktop: number;       // 데스크탑
    tablet: number;        // 태블릿
  };
  peakDay: {
    date: string;
    count: number;
  };
}
```

**표시 정보:**
- 총 방문자 수 (크게)
- 오늘 방문자 / 전일 대비 증감
- 기기별 비율 (모바일 우세 예상)

### 2.2. RSVP 응답률

```tsx
interface RsvpStats {
  total: number;           // 총 응답 수
  attending: number;       // 참석
  notAttending: number;    // 불참
  responseRate: number;    // 응답률 (%)
  expectedGuests: number;  // 예상 참석 인원 (동반 포함)
  bySide: {
    groom: number;         // 신랑측
    bride: number;         // 신부측
  };
  mealCount: number;       // 식사 인원
}
```

**표시 정보:**
- 응답률 % (참석+불참 / 방문자)
- 참석 vs 불참 비율 막대
- 신랑측 / 신부측 분포
- 예상 총 참석 인원

### 2.3. 방명록 현황

```tsx
interface GuestbookStats {
  total: number;           // 총 메시지 수
  today: number;           // 오늘 작성
  recentMessages: Array<{
    id: string;
    name: string;
    content: string;       // 미리보기 (50자)
    createdAt: string;
  }>;
}
```

### 2.4. 공유 현황

```tsx
interface ShareStats {
  total: number;
  byChannel: {
    kakao: number;         // 카카오톡
    link: number;          // 링크 복사
    other: number;         // 기타
  };
}
```

---

## 3. 상세 분석

### 3.1. 방문자 추이 차트

```
일별 방문자 (최근 30일)

     60 ┤
        │            ╭─╮
     50 ┤           ╭╯ ╰╮
        │          ╭╯   ╰╮
     40 ┤    ╭─╮  ╭╯     ╰─╮
        │   ╭╯ ╰╮╭╯        ╰╮
     30 ┤  ╭╯   ╰╯          ╰─╮
        │ ╭╯                   ╰╮
     20 ┤╭╯                     ╰─╮
        │                          ╰─
     10 ┤
        │
      0 ┼────────────────────────────
        1/1  1/5  1/10 1/15 1/20 1/25
```

**필터 옵션:**
- 기간: 7일 / 30일 / 전체
- 단위: 일별 / 시간대별

### 3.2. RSVP 명단

```
┌─────────────────────────────────────────────────────────────────┐
│  ✅ RSVP 명단                              [엑셀 다운로드] [필터] │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  필터: [전체 ▼] [신랑측 ▼] [참석 ▼]           검색: [________]   │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐ │
│  │ 이름     │ 참석  │ 인원 │ 측   │ 식사 │ 연락처      │ 일시  │ │
│  ├───────────────────────────────────────────────────────────┤ │
│  │ 김철수   │ ✅    │  2   │ 신랑 │ 예   │ 010-1234-** │ 1/5  │ │
│  │ 이영희   │ ✅    │  1   │ 신부 │ 예   │ 010-5678-** │ 1/5  │ │
│  │ 박지민   │ ❌    │  -   │ 신랑 │ -    │ -           │ 1/4  │ │
│  │ 최수진   │ ✅    │  3   │ 신부 │ 예   │ 010-9012-** │ 1/3  │ │
│  └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│  1-20 / 156                              [< 이전] [다음 >]      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**기능:**
- 필터링 (참석/불참, 신랑측/신부측)
- 검색 (이름)
- 엑셀 다운로드
- 정렬 (이름, 일시, 인원)

### 3.3. 갤러리 인사이트 (P2)

```tsx
interface GalleryInsight {
  totalViews: number;           // 총 사진 조회
  avgViewsPerVisitor: number;   // 방문자당 평균 조회
  popularPhotos: Array<{
    photoId: string;
    thumbnailUrl: string;
    viewCount: number;
    avgViewDuration: number;    // 평균 조회 시간
  }>;
  lightboxOpenRate: number;     // 확대 보기 비율
}
```

**표시 정보:**
- 인기 사진 TOP 3
- 사진별 조회수
- 확대 보기 비율

---

## 4. RSVP 알림

### 4.1. 실시간 알림

```tsx
// 새로운 RSVP 제출 시 알림
interface RsvpNotification {
  type: 'rsvp_new';
  data: {
    name: string;
    attendance: 'yes' | 'no';
    guestCount: number;
    side: 'groom' | 'bride';
    timestamp: string;
  };
}

// 푸시 알림 또는 대시보드 알림
"🎉 김철수님이 참석(2명)으로 응답했습니다."
```

### 4.2. 일일 요약 알림

```
📊 오늘의 청첩장 현황

• 방문자: 32명 (+5)
• 새 RSVP: 8건
• 방명록: 3개

현재 예상 참석 인원: 156명
```

---

## 5. 데이터 내보내기

### 5.1. RSVP 명단 엑셀

```
| 이름   | 참석여부 | 인원 | 신랑/신부측 | 식사 | 연락처       | 응답일시          |
|--------|----------|------|-------------|------|--------------|-------------------|
| 김철수 | 참석     | 2    | 신랑        | 예   | 010-1234-5678| 2025-01-05 14:30 |
| 이영희 | 참석     | 1    | 신부        | 예   | 010-5678-1234| 2025-01-05 15:20 |
```

### 5.2. 통계 리포트 PDF (P2)

- 주요 지표 요약
- 방문자 추이 그래프
- RSVP 분석
- 인기 콘텐츠

---

## 6. 데이터 모델

### 6.1. 분석 이벤트

```prisma
model AnalyticsEvent {
  id            String   @id @default(cuid())
  invitationId  String
  invitation    Invitation @relation(fields: [invitationId], references: [id])
  
  eventType     String   // "page_view", "rsvp_submit", "photo_view", etc.
  sessionId     String   // 방문 세션 ID
  visitorId     String   // 고유 방문자 ID (쿠키/핑거프린트)
  
  metadata      Json?    // 이벤트별 추가 데이터
  
  userAgent     String?
  deviceType    String?  // "mobile", "desktop", "tablet"
  referrer      String?  // 유입 경로
  
  createdAt     DateTime @default(now())
  
  @@index([invitationId, eventType])
  @@index([invitationId, createdAt])
}
```

### 6.2. 일별 집계

```prisma
model DailyStats {
  id            String   @id @default(cuid())
  invitationId  String
  invitation    Invitation @relation(fields: [invitationId], references: [id])
  
  date          DateTime @db.Date
  
  pageViews     Int      @default(0)
  uniqueVisitors Int     @default(0)
  rsvpCount     Int      @default(0)
  guestbookCount Int     @default(0)
  shareCount    Int      @default(0)
  
  @@unique([invitationId, date])
}
```

---

## 7. API Endpoints

```
GET /api/invitations/:id/analytics/summary
  - 주요 지표 요약

GET /api/invitations/:id/analytics/visitors
  - 방문자 추이 (기간 파라미터)

GET /api/invitations/:id/analytics/rsvp
  - RSVP 상세 통계

GET /api/invitations/:id/rsvp
  - RSVP 명단 (페이지네이션)

GET /api/invitations/:id/rsvp/export
  - RSVP 엑셀 다운로드

GET /api/invitations/:id/analytics/gallery
  - 갤러리 인사이트
```

---

## 8. 개인정보 보호

### 8.1. 데이터 수집 고지

```
청첩장 분석을 위해 다음 정보를 수집합니다:
- 방문 시간 및 페이지 조회
- 기기 유형 (모바일/데스크탑)
- RSVP 응답 정보

개인을 특정할 수 있는 정보는 수집하지 않습니다.
```

### 8.2. RSVP 연락처 마스킹

```typescript
// 대시보드에서 연락처 부분 마스킹
function maskPhone(phone: string): string {
  // 010-1234-5678 → 010-1234-**78
  return phone.replace(/(\d{3})-(\d{4})-(\d{2})(\d{2})/, '$1-$2-**$4');
}
```

### 8.3. 데이터 보관 기간

| 데이터 | 보관 기간 | 이후 처리 |
|--------|----------|----------|
| 분석 이벤트 | 예식일 + 1년 | 자동 삭제 |
| RSVP 명단 | 예식일 + 1년 | 익명화 또는 삭제 |
| 일별 집계 | 무기한 | 익명 통계로 보관 |

---

## 9. 성능 고려사항

### 9.1. 실시간 vs 배치

| 지표 | 업데이트 방식 |
|------|--------------|
| 방문자 수 | 실시간 (Redis 카운터) |
| RSVP 현황 | 실시간 (DB 직접 조회) |
| 일별 통계 | 배치 (매시간 집계) |
| 차트 데이터 | 캐시 (5분 TTL) |

### 9.2. 쿼리 최적화

```sql
-- 일별 방문자 집계 (인덱스 활용)
SELECT 
  DATE(created_at) as date,
  COUNT(DISTINCT visitor_id) as unique_visitors
FROM analytics_events
WHERE 
  invitation_id = ? 
  AND event_type = 'page_view'
  AND created_at >= ?
GROUP BY DATE(created_at)
ORDER BY date;
```

---

## 10. 향후 확장 (P3)

### 10.1. 비교 분석

- 다른 청첩장 평균과 비교
- "상위 10% 성과" 배지

### 10.2. 예측 분석

- 예상 최종 참석 인원 예측
- RSVP 마감일 제안

### 10.3. A/B 테스트

- 두 가지 버전 성과 비교
- 전환율 최적화
